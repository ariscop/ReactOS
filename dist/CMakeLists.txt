
add_cabinet(reactos ${REACTOS_SOURCE_DIR}/boot/bootdata/packages/reactos.dff.in)

add_iso(bootcd)
#add_iso(livecd EXCLUDE_FROM_ALL)
#add_iso(hybridcd EXCLUDE_FROM_ALL)
#add_iso(regtest EXCLUDE_FROM_ALL)

function(_add_empty_folders _target _prefix)
    # Create the empty Desktop, Favorites, and Start Menu folders. And many more.
    add_iso_folder(${_target} "${_prefix}Profiles/All Users/Application Data")
    add_iso_folder(${_target} "${_prefix}Profiles/All Users/Documents/My Music")
    add_iso_folder(${_target} "${_prefix}Profiles/All Users/Documents/My Pictures")
    add_iso_folder(${_target} "${_prefix}Profiles/All Users/Documents/My Videos")
    add_iso_folder(${_target} "${_prefix}Profiles/All Users/Favorites")
    add_iso_folder(${_target} "${_prefix}Profiles/All Users/My Documents")
    add_iso_folder(${_target} "${_prefix}Profiles/All Users/Start Menu/Programs/StartUp")
    add_iso_folder(${_target} "${_prefix}Profiles/All Users/Templates")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Application Data")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Application Data/Microsoft/Internet Explorer/Quick Launch")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Cookies")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Desktop")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Favorites")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Local Settings/Application Data")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Local Settings/History")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Local Settings/Temporary Internet Files")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/My Music")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/My Pictures")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/My Videos")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/NetHood")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/PrintHood")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Recent")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/SendTo")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Start Menu/Programs")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Start Menu/Programs/Administrative Tools")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Start Menu/Programs/StartUp")
    add_iso_folder(${_target} "${_prefix}Profiles/Default User/Templates")
endfunction()

#_add_empty_folders(livecd "")
#_add_empty_folders(hybridcd "livecd/")

add_iso_file(bootcd FILE ${CMAKE_CURRENT_BINARY_DIR}/reactos.inf DESTINATION reactos)
add_iso_file(bootcd FILE ${CMAKE_CURRENT_BINARY_DIR}/reactos.cab DESTINATION reactos)

function(add_cd_file)
    _add_cd_file(${ARGN})
    cmake_parse_arguments(_CD "NO_CAB;NOT_IN_HYBRIDCD" "DESTINATION;NAME_ON_CD;TARGET;FILE" "FOR" ${ARGN})
    #message(STATUS "${ARGN}")

    # do we add it to all CDs?
    list(FIND _CD_FOR all __cd)
    if(NOT __cd EQUAL -1)
        list(REMOVE_AT _CD_FOR __cd)
        list(INSERT _CD_FOR __cd "bootcd;livecd;regtest")
    endif()

    # do we add it to bootcd?
    list(FIND _CD_FOR bootcd __cd)
    if(NOT __cd EQUAL -1)
        # whether or not we should put it in reactos.cab or directly on cd
        if(_CD_NO_CAB)
            if(_CD_FILE)
                set(_dest ${_CD_DESTINATION})
                if(_dest STREQUAL "root")
                    set(_dest "")
                endif()
                add_iso_file(bootcd FILE ${_CD_FILE} DESTINATION ${_dest} NAME "${_CD_NAME_ON_CD}")
                if(_CD_TARGET)
                    set_property(TARGET bootcd_iso APPEND PROPERTY _iso_depends ${_CD_TARGET})
                endif()
            else()
                add_iso_file(bootcd TARGET ${_CD_TARGET} DESTINATION ${_CD_DESTINATION} NAME "${_CD_NAME_ON_CD}")
            endif()
        else()
            string(REGEX REPLACE "^reactos/?" "" _dest ${_CD_DESTINATION})
            if(_dest STREQUAL "root" OR _dest STREQUAL "")
                set(_dest "/")
            endif()

            if(_CD_FILE)
                add_cab_file(reactos FILE ${_CD_FILE} DESTINATION ${_dest})
                if(_CD_TARGET)
                    set_property(TARGET reactos_cabman APPEND PROPERTY _cab_file_depends ${_CD_TARGET})
                endif()
            else()
                add_cab_file(reactos TARGET ${_CD_TARGET} DESTINATION ${_dest})
            endif()
        endif()
    endif() #end bootcd
endfunction()
